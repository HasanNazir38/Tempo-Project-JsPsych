<!DOCTYPE html>
<html>
  <head>
    <title>Tempo Determination Experiment</title>
    <script src="https://unpkg.com/jspsych@7.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
    <script src="plugin-tempochanger/index.js"></script>
    <!-- gonna need a script source with taptask and tempochanger -->
    <!-- <link rel="stylesheet" type="text/css" href="Views/style.css"> -->
    </head>
  <body></body>
  <script>

/*
    Tempo Determination Experiment, running in jsPsych
Currently the audio playback and manipulation run with WebAudio and jsSoundTouch, as utilized within
the TempoChangerPlugin. If MIDI is the desired format for audio playback and manipulation, that can be
done by creating and using a different plugin that can handle that. 
*/


var jsPsych = initJsPsych();
var timeline =[];

// Preload all the audio files for the experiment
var preload = {
    type: jsPsychPreload,
    //TODO: load in audio
};
timeline.push(preload);

// TODO!!!
// - Generate userId (described on jsPsych page)
// - Loading in stimuli properly
// - Handle output data (making sure its in the correct csv form, has everything it needs
//      aggregates correctly, prints to csv correctly, and is stored somewhere accessible.
//      Data storage might be a bit confusing because of server stuff and it being online)
// - Counter for how many trials left in a block (could use built in progress bar feature instead)
//       - I need to track trials and blocks anyways


/* ALL THE COMPONENTS OF THE EXPERIMENT */

// Stimuli arrays
var noContextStim = [
    {audio: 'insertaudiofilename'},
    {audio: 'insertaudiofilename'},
    {audio: 'insertaudiofilename'},
];

var contextStim = [
    {audio: 'insertaudiofilename'},
    {audio: 'insertaudiofilename'},
    {audio: 'insertaudiofilename'},
];


// Trial types
var tempoTask = {
    type: jsPsychTempoChanger,
    stimulus: jsPsych.timelineVariable('audio'),
/* ---Variables you can adjust in the trial--- */
    // startTempo: 800 // in ms
    // changeRate: 0.02 // factor that adjusts the rate of tempo change
    // jitter: 10 // margin for start time randomization
    //data : {},
};

var tapTask = {
    type: TapTask,
    stimulus: jsPsych.timelineVariable('audio'), // Should take the endTempo data from the tempoTask
    //data: {,}
};


// Blocks
var withContext = {
    timeline: [tempoTask, tapTask],
    timeline_variables: contextStim,
    randomize_order: true,
};

var withoutContext = {
    timeline: [tempoTask, tapTask],
    timeline_variables: noContextStim,
    randomize_order: true,
};

// A break between the blocks. Add as needed
var between = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Trial block Completed, press any button to begin the next block"
};


/* EXPERIMENT TIMELINE*/

// Create welcome message
var welcome = {
    type: jsPsychHtmlKeyboardResponse, 
    stimulus: "Welcome to the Tempo Determination Experiment. Press any key to begin."
    //maybe make all these into mouse clicks considering its basically all done with the mouse
};
timeline.push(welcome);

// Instructions page
var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "heres ya dang instructions"
};
timeline.push(instructions);

// Practice run
var practice = {
    timeline: [tempoTask, tapTask],
    timeline_variables: {audio: 'audioname'},
};
timeline.push(practice);

var begin = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Press any button to begin experiment"
};
timeline.push(begin);
// Trial block, add as needed, will run as many times as there are files defined in its array
timeline.push(withContext); 
timeline.push(between);
timeline.push(withoutContext);

// End of experiment
//!!!! just a landing page baasically

/* RUN EXPERIMENT */
jsPsych.run(timeline);
    </script>
</html>
